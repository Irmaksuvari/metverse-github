<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giri≈ü Yap - MetVerse</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Dinamik Header Bile≈üeni -->
    <div id="header-container"></div>
    <script src="js/header.js"></script>

    <!-- Giri≈ü Se√ßim Section -->
    <section class="section-choice">
        <div class="choice-container">
            <div class="choice-header">
                <h1>MetVerse'e <span class="highlight">Ho≈ü Geldiniz</span></h1>
                <p>Giri≈ü yapmak i√ßin bir se√ßenek se√ßin</p>
            </div>

            <div class="choice-grid">
                <!-- Marka Giri≈üi -->
                <div class="choice-card">
                    <div class="choice-icon">üè¢</div>
                    <h2>Marka Olarak Giri≈ü Yap</h2>
                    <p>Markalar i√ßin kampanya y√∂netim aracƒ±na eri≈üin</p>
                    <form class="choice-form">
                        <div class="form-group">
                            <label for="brand-email">E-posta Adresi</label>
                            <input type="email" id="brand-email" placeholder="E-posta adresinizi girin" required>
                        </div>
                        <div class="form-group">
                            <label for="brand-password">≈ûifre</label>
                            <input type="password" id="brand-password" placeholder="≈ûifrenizi girin" required>
                        </div>
                        <button type="submit" class="form-button">Giri≈ü Yap</button>
                    </form>
                </div>

                <!-- Influencer Giri≈üi -->
                <div class="choice-card">
                    <div class="choice-icon">ü§≥</div>
                    <h2>Influencer Olarak Giri≈ü Yap</h2>
                    <p>Influencer platformuna eri≈üin ve kampanyalara ba≈üvurun</p>
                    <form class="choice-form">
                        <div class="form-group">
                            <label for="influencer-email">E-posta Adresi</label>
                            <input type="email" id="influencer-email" placeholder="E-posta adresinizi girin" required>
                        </div>
                        <div class="form-group">
                            <label for="influencer-password">≈ûifre</label>
                            <input type="password" id="influencer-password" placeholder="≈ûifrenizi girin" required>
                        </div>
                        <button type="submit" class="form-button">Giri≈ü Yap</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <script>
        // ============================================
        // Gƒ∞Rƒ∞≈û SAYFASI SCRIPT'ƒ∞
        // ============================================
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ Giri≈ü Sayfasƒ± Y√ºklendi');
            
            // Menu Toggle
            const menuToggle = document.getElementById('menuToggle');
            const navMenu = document.getElementById('navMenu');
            const navOverlay = document.getElementById('navOverlay');
            const body = document.body;

            if (menuToggle && navMenu && navOverlay) {
                menuToggle.addEventListener('click', () => {
                    menuToggle.classList.toggle('active');
                    navMenu.classList.toggle('active');
                    navOverlay.classList.toggle('active');
                    body.style.overflow = navMenu.classList.contains('active') ? 'hidden' : 'auto';
                });

                navOverlay.addEventListener('click', () => {
                    menuToggle.classList.remove('active');
                    navMenu.classList.remove('active');
                    navOverlay.classList.remove('active');
                    body.style.overflow = 'auto';
                });

                // Menu items click handler
                document.querySelectorAll('.nav-menu-item').forEach(item => {
                    item.addEventListener('click', () => {
                        menuToggle.classList.remove('active');
                        navMenu.classList.remove('active');
                        navOverlay.classList.remove('active');
                        body.style.overflow = 'auto';
                    });
                });
            }

            // Form submission handlers - MARKA FORMU
            const allForms = document.querySelectorAll('.choice-form');
            console.log('üìã Bulundu form sayƒ±sƒ±:', allForms.length);
            
            if (allForms.length >= 1) {
                const brandForm = allForms[0];
                console.log('‚úÖ Marka form baƒülandƒ±');
                brandForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    console.log('üîÑ Marka giri≈ü formu g√∂nderiliyor...');
                    
                    const email = document.getElementById('brand-email').value.trim();
                    const sifre = document.getElementById('brand-password').value;

                    // Validasyon
                    if (!email) {
                        console.warn('‚ö†Ô∏è E-posta bo≈ü');
                        alert('‚ùå L√ºtfen E-posta giriniz!');
                        return;
                    }

                    try {
                        console.log('üì§ POST /api/marka-login g√∂nderiliyor...');
                        const response = await fetch('/api/marka-login', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                email: email || null,
                                sifre: sifre
                            })
                        });

                        const data = await response.json();
                        console.log('üìç Backend Cevabƒ±:', data);

                        if (data.success) {
                            console.log('‚úÖ Giri≈ü Ba≈üarƒ±lƒ±!');
                            // Token'ƒ± localStorage'a kaydet
                            localStorage.setItem('token', data.token);
                            localStorage.setItem('user', JSON.stringify(data.user));
                            
                            console.log('üìå Y√∂nlendir:', data.redirectUrl);
                            // Direkt y√∂nlendir
                            window.location.href = data.redirectUrl;
                        } else {
                            alert('‚ùå ' + data.message);
                        }
                    } catch (error) {
                        console.error('‚ùå Giri≈ü hatasƒ±:', error);
                        alert('‚ùå Bir hata olu≈ütu. L√ºtfen tekrar deneyin.');
                    }
                });
            } else {
                console.error('‚ùå Marka form bulunamadƒ±!');
            }

            // Form submission handlers - INFLUENCER FORMU
            if (allForms.length >= 2) {
                const influencerForm = allForms[1];
                console.log('‚úÖ Influencer form baƒülandƒ±');
                influencerForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    console.log('üîÑ Influencer giri≈ü formu g√∂nderiliyor...');
                    
                    const email = document.getElementById('influencer-email').value.trim();
                    const sifre = document.getElementById('influencer-password').value;

                    console.log('üìù Giri≈ü verileri:', { email, sifre: '***' });

                    // Validasyon
                    if (!email) {
                        console.warn('‚ö†Ô∏è E-posta bo≈ü');
                        alert('‚ùå L√ºtfen E-posta giriniz!');
                        return;
                    }
                    if (!sifre) {
                        console.warn('‚ö†Ô∏è ≈ûifre bo≈ü');
                        alert('‚ùå L√ºtfen ≈üifre giriniz!');
                        return;
                    }

                    try {
                        console.log('üì§ POST /api/influencer-login g√∂nderiliyor...');
                        const response = await fetch('/api/influencer-login', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                email: email || null,
                                sifre: sifre
                            })
                        });

                        console.log('üì® Response Status:', response.status, response.statusText);
                        console.log('üì® Response OK:', response.ok);

                        let data;
                        try {
                            data = await response.json();
                            console.log('üìç JSON Parsed:', JSON.stringify(data, null, 2));
                            console.log('üìç Object Keys:', Object.keys(data));
                            console.log('üìç token field:', data.token);
                            console.log('üìç success field:', data.success);
                        } catch (jsonError) {
                            console.error('‚ùå JSON parse error:', jsonError);
                            alert('‚ùå Sunucu yanƒ±tƒ± hatalƒ± formatta.');
                            return;
                        }

                        if (data && data.success === true) {
                            console.log('‚úÖ Giri≈ü Ba≈üarƒ±lƒ±!');
                            console.log('üîë Token:', data.token ? '‚úÖ VAR' : '‚ùå YOK');
                            console.log('üë§ User:', data.user ? '‚úÖ VAR' : '‚ùå YOK');
                            console.log('üìå Redirect URL:', data.redirectUrl);
                            
                            // Token'ƒ± localStorage'a kaydet
                            try {
                                localStorage.setItem('token', data.token);
                                localStorage.setItem('user', JSON.stringify(data.user));
                                console.log('üíæ localStorage g√ºncellendi');
                            } catch (storageError) {
                                console.error('‚ùå localStorage yazma hatasƒ±:', storageError);
                            }
                            
                            // Y√∂nlendir
                            const redirectUrl = data.redirectUrl || '/influencer_anasayfa.html';
                            console.log('üöÄ Y√∂nlendir:', redirectUrl);
                            
                            // Biraz bekle sonra y√∂nlendir
                            setTimeout(() => {
                                console.log('üîÑ window.location.href yapƒ±lƒ±yor:', redirectUrl);
                                window.location.href = redirectUrl;
                            }, 100);
                        } else {
                            console.error('‚ùå Giri≈ü Ba≈üarƒ±sƒ±z - success !== true');
                            console.error('üìå Response:', data);
                            alert('‚ùå ' + (data?.message || 'Giri≈ü ba≈üarƒ±sƒ±z'));
                        }
                    } catch (error) {
                        console.error('‚ùå Fetch hatasƒ±:', error);
                        console.error('‚ùå Error type:', error.constructor.name);
                        console.error('‚ùå Error message:', error.message);
                        alert('‚ùå Bir hata olu≈ütu. L√ºtfen tekrar deneyin: ' + error.message);
                    }
                });
            } else {
                console.error('‚ùå Influencer form bulunamadƒ±!');
            }

            // Scroll event for header background color change
            window.addEventListener('scroll', () => {
                const nav = document.querySelector('nav');
                if (window.scrollY > 50) {
                    nav.classList.add('scrolled');
                } else {
                    nav.classList.remove('scrolled');
                }
            });
        });
    </script>
</body>
</html>
